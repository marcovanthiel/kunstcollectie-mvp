"use strict";(()=>{var e={};e.id=868,e.ids=[868],e.modules={3524:e=>{e.exports=require("@prisma/client")},7096:e=>{e.exports=require("bcrypt")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7469:(e,t,r)=>{r.r(t),r.d(t,{config:()=>d,default:()=>c,routeModule:()=>p});var a={};r.r(a),r.d(a,{default:()=>u});var n=r(1802),s=r(7153),i=r(6249),o=r(7864),l=r(9823);let handler=async(e,t)=>"GET"===e.method?getReport(e,t):(t.setHeader("Allow",["GET"]),t.status(405).json({error:`Methode ${e.method} niet toegestaan`})),getReport=async(e,t)=>{try{let{type:r,artistId:a,locationId:n,typeId:s,startDate:i,endDate:o,minValue:l,maxValue:u}=e.query;if(!r)return t.status(400).json({error:"Rapport type is verplicht."});let c={};switch(a&&(c.artistId=parseInt(a)),n&&(c.locationId=parseInt(n)),s&&(c.typeId=parseInt(s)),(i||o)&&(c.purchaseDate={},i&&(c.purchaseDate.gte=new Date(i)),o&&(c.purchaseDate.lte=new Date(o))),(l||u)&&(c.marketValue={},l&&(c.marketValue.gte=parseFloat(l)),u&&(c.marketValue.lte=parseFloat(u))),r){case"inventory":return await generateInventoryReport(t,c);case"value":return await generateValueReport(t,c);case"artist":return await generateArtistReport(t,c);case"location":return await generateLocationReport(t,c);default:return t.status(400).json({error:"Ongeldig rapport type."})}}catch(e){return console.error("Error generating report:",e),t.status(500).json({error:"Er is een fout opgetreden bij het genereren van het rapport."})}},generateInventoryReport=async(e,t)=>{let r=await o.Z.artwork.findMany({where:t,include:{artist:{select:{name:!0}},artworkType:{select:{name:!0}},location:{select:{name:!0}}},orderBy:{title:"asc"}}),a={title:"Inventarisatie Overzicht",generatedAt:new Date,totalItems:r.length,items:r.map(e=>({id:e.id,title:e.title,artist:e.artist.name,type:e.artworkType.name,year:e.year,dimensions:e.height&&e.width?`${e.height} x ${e.width}${e.depth?" x "+e.depth:""} cm`:"Onbekend",location:e.location?.name||"Onbekend"}))};return e.status(200).json(a)},generateValueReport=async(e,t)=>{let r=await o.Z.artwork.findMany({where:t,select:{id:!0,title:!0,artist:{select:{name:!0}},purchaseDate:!0,purchasePrice:!0,marketValue:!0,insuredValue:!0},orderBy:{marketValue:"desc"}}),a=r.reduce((e,t)=>e+(t.purchasePrice||0),0),n=r.reduce((e,t)=>e+(t.marketValue||0),0),s=r.reduce((e,t)=>e+(t.insuredValue||0),0),i={title:"Waarde Rapportage",generatedAt:new Date,totalItems:r.length,summary:{totalPurchaseValue:a,totalMarketValue:n,totalInsuredValue:s,valueChange:a>0?((n-a)/a*100).toFixed(2)+"%":"N/A"},items:r.map(e=>({id:e.id,title:e.title,artist:e.artist.name,purchaseDate:e.purchaseDate,purchasePrice:e.purchasePrice,marketValue:e.marketValue,insuredValue:e.insuredValue,valueChange:e.purchasePrice&&e.marketValue?((e.marketValue-e.purchasePrice)/e.purchasePrice*100).toFixed(2)+"%":"N/A"}))};return e.status(200).json(i)},generateArtistReport=async(e,t)=>{let r=await o.Z.artist.findMany({include:{artworks:{where:t,include:{artworkType:{select:{name:!0}}}}},orderBy:{name:"asc"}}),a=r.filter(e=>e.artworks.length>0),n=a.map(e=>{let t=e.artworks.reduce((e,t)=>e+(t.marketValue||0),0),r={};return e.artworks.forEach(e=>{let t=e.artworkType.name;r[t]||(r[t]=[]),r[t].push(e)}),{id:e.id,name:e.name,artworkCount:e.artworks.length,totalValue:t,artworksByType:Object.entries(r).map(([e,t])=>({type:e,count:t.length,items:t.map(e=>({id:e.id,title:e.title,year:e.year,value:e.marketValue}))}))}}),s={title:"Kunstenaars Analyse",generatedAt:new Date,totalArtists:a.length,totalArtworks:a.reduce((e,t)=>e+t.artworks.length,0),artists:n};return e.status(200).json(s)},generateLocationReport=async(e,t)=>{let r=await o.Z.location.findMany({include:{locationType:!0,artworks:{where:t,include:{artist:{select:{name:!0}},artworkType:{select:{name:!0}}}}},orderBy:{name:"asc"}}),a=r.filter(e=>e.artworks.length>0),n=a.map(e=>{let t=e.artworks.reduce((e,t)=>e+(t.marketValue||0),0);return{id:e.id,name:e.name,type:e.locationType.name,address:e.address,city:e.city,artworkCount:e.artworks.length,totalValue:t,artworks:e.artworks.map(e=>({id:e.id,title:e.title,artist:e.artist.name,type:e.artworkType.name,year:e.year,value:e.marketValue}))}}),s={title:"Locatie Overzicht",generatedAt:new Date,totalLocations:a.length,totalArtworks:a.reduce((e,t)=>e+t.artworks.length,0),locations:n};return e.status(200).json(s)},u=(0,l.fS)(handler),c=(0,i.l)(a,"default"),d=(0,i.l)(a,"config"),p=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/reports",pathname:"/api/reports",bundlePath:"",filename:""},userland:a})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[222,896],()=>__webpack_exec__(7469));module.exports=r})();